# Task ID: 3
# Title: Configure ngrok for External Access
# Status: pending
# Dependencies: 2
# Priority: high
# Description: Set up ngrok to expose the local development server to the internet for Strava OAuth callback and testing.
# Details:
1. Install ngrok globally or as a project dependency
2. Configure ngrok to expose the local server port
3. Set up a persistent URL if possible (with paid ngrok account)
4. Update environment variables to use the ngrok URL for callbacks
5. Document the process for the development team

```bash
# Install ngrok
npm install -g ngrok

# Start ngrok tunnel
ngrok http 3000
```

Add to your server startup script:
```javascript
console.log('Server accessible at: ' + process.env.NGROK_URL);
console.log('For OAuth callbacks, use: ' + process.env.NGROK_URL + '/auth/strava/callback');
```

# Test Strategy:
Verify the local server is accessible via the ngrok URL. Test that the Strava OAuth callback works through the ngrok tunnel. Ensure the URL is properly configured in the Strava API settings.

# Subtasks:
## 1. Install and Configure ngrok [pending]
### Dependencies: None
### Description: Install ngrok and set up basic tunneling for local development server
### Details:
1. Install ngrok globally using npm install -g ngrok or as a project dependency
2. Verify installation by running ngrok version
3. Create a free ngrok account if not already done
4. Authenticate ngrok with your authtoken using ngrok authtoken YOUR_TOKEN
5. Test basic tunnel setup with ngrok http 3000 (or your application port)
6. Verify tunnel is working by accessing the provided URL in a browser
<info added on 2025-07-18T10:43:11.542Z>
## Test Strategy for ngrok Installation and Configuration

1. **ngrok Installation Verification**: Run `ngrok version` to verify successful installation
2. **Tunnel Creation Testing**: Start ngrok with `ngrok http 3000` and verify tunnel is created
3. **Browser-based Tunnel Testing**: Open the ngrok-provided URL in browser and verify it reaches local server
4. **External Access Testing**: Test the public URL from a different device or network
5. **Tunnel Status Verification**: Check ngrok web interface (localhost:4040) to verify tunnel details
6. **HTTPS Testing**: Verify both HTTP and HTTPS URLs work correctly
7. **Tunnel Stability Testing**: Leave tunnel running for extended period to test stability
8. **Pass/Fail Criteria**: Tunnel created successfully, public URL accessible from external networks, both HTTP/HTTPS work
</info added on 2025-07-18T10:43:11.542Z>

## 2. Set Up Persistent URL Configuration [pending]
### Dependencies: 3.1
### Description: Configure ngrok for consistent URL usage with paid features
### Details:
1. Evaluate ngrok paid plans for persistent URL feature
2. If using paid plan, reserve a custom subdomain
3. Configure ngrok to use the reserved subdomain: ngrok http --subdomain=your-subdomain 3000
4. Test the persistent URL to ensure it works consistently
5. Document the persistent URL for team reference
6. If using free plan, document the process for updating URLs in Strava API settings when ngrok URLs change
<info added on 2025-07-18T10:43:21.986Z>
## Test Strategy for Persistent URL Configuration

1. **Reserved Domain Testing**: Configure ngrok with a reserved domain and verify it works consistently
2. **URL Consistency Testing**: Restart ngrok multiple times and verify the same URL is maintained
3. **Browser Bookmark Testing**: Bookmark the ngrok URL and verify it remains accessible across sessions
4. **Configuration File Testing**: Test ngrok config file (ngrok.yml) loads correctly
5. **Tunnel Persistence Testing**: Test that tunnel persists across local server restarts
6. **Custom Subdomain Testing**: Test custom subdomain functionality if using paid plan
7. **Dashboard Access Testing**: Verify ngrok dashboard shows consistent tunnel information
8. **Pass/Fail Criteria**: Same URL maintained across restarts, configuration loads correctly, tunnel persists
</info added on 2025-07-18T10:43:21.986Z>

## 3. Integrate ngrok with Environment Variables [pending]
### Dependencies: 3.1, 3.2
### Description: Configure the application to use ngrok URLs through environment variables
### Details:
1. Create a script to automatically capture the ngrok URL when tunnel starts
2. Update the .env file or environment configuration to include NGROK_URL variable
3. Modify application code to use process.env.NGROK_URL for callback URLs
4. Update Strava API settings with the ngrok callback URL
5. Test that the application correctly uses the ngrok URL for callbacks
6. Implement a solution for development vs. production URL handling
<info added on 2025-07-18T10:43:33.677Z>
**Test Strategy**: 
1. **Environment Variable Testing**: Verify ngrok URL is correctly loaded from environment variables
2. **Dynamic URL Testing**: Test application detects and uses current ngrok URL automatically
3. **Callback URL Testing**: Test OAuth callbacks work with dynamically set ngrok URLs
4. **Browser-based URL Testing**: Test that frontend JavaScript can access and use the ngrok URL
5. **API Integration Testing**: Test that external APIs can reach the application via ngrok URL
6. **URL Validation Testing**: Test that invalid or malformed URLs are handled gracefully
7. **Cross-Environment Testing**: Test URL configuration works in development, staging, and production environments
8. **Pass/Fail Criteria**: Environment variables set correctly, URLs work in all contexts, external services can reach app
</info added on 2025-07-18T10:43:33.677Z>

## 4. Document ngrok Setup and Troubleshooting [pending]
### Dependencies: 3.1, 3.2, 3.3
### Description: Create comprehensive documentation for the team on ngrok usage and common issues
### Details:
1. Document the complete ngrok setup process with screenshots
2. Create a troubleshooting guide for common issues:
   - Port already in use errors
   - Firewall blocking connections
   - Authentication failures
   - Callback URL issues with Strava
3. Document security considerations and best practices
4. Create a quick-start guide for new team members
5. Include information on ngrok inspector for debugging requests
6. Document how to restart tunnels when needed
<info added on 2025-07-18T10:43:48.224Z>
## Test Strategy for ngrok Documentation

1. **Documentation Completeness Testing**: Review documentation for all required setup steps and verify completeness
2. **Step-by-Step Validation**: Follow documentation on a fresh system to verify all steps work correctly
3. **Troubleshooting Guide Testing**: Test common issues and verify troubleshooting steps resolve them
4. **Browser-based Documentation**: Create documentation that can be viewed in browser (GitHub Pages, etc.)
5. **Team Accessibility Testing**: Share documentation with team members and verify they can follow it successfully
6. **Screenshot Documentation**: Include screenshots of key steps and verify they are clear and helpful
7. **Link Validation**: Test all links in documentation to ensure they are working and up-to-date
8. **Pass/Fail Criteria**: Documentation complete, all steps work, troubleshooting effective, accessible to team
</info added on 2025-07-18T10:43:48.224Z>

