{{ 'sportive-prints-page.css' | asset_url | stylesheet_tag }}

{%- liquid
  assign collection = section.settings.collection
  if collection.products.size == 0
    assign has_products = false
  else
    assign has_products = true
  endif
-%}

<div class="sportive-products-section">
  <div class="page-width">
    {%- if section.settings.heading != blank or section.settings.description != blank -%}
      <div class="sportive-products-header">
        {%- if section.settings.heading != blank -%}
          <h2 class="sportive-products-heading">
            {{ section.settings.heading | escape }}
          </h2>
        {%- endif -%}
        {%- if section.settings.description != blank -%}
          <div class="sportive-products-description rte">
            {{ section.settings.description }}
          </div>
        {%- endif -%}
      </div>
    {%- endif -%}

    {%- if has_products -%}
      <div class="sportive-products-grid">
        {%- for product in collection.products limit: section.settings.products_to_show -%}
          <a href="{{ product.url | within: collection }}" class="sportive-product-card">

            {%- comment -%} Product Badge {%- endcomment -%}
            {%- if section.settings.show_badge and product.metafields.custom.badge != blank -%}
              <div class="sportive-product-badge">
                {{ product.metafields.custom.badge }}
              </div>
            {%- elsif product.tags contains 'bestseller' -%}
              <div class="sportive-product-badge">
                Bestseller
              </div>
            {%- elsif product.available == false -%}
              <div class="sportive-product-badge">
                Sold Out
              </div>
            {%- endif -%}

            {%- comment -%} Product Image {%- endcomment -%}
            <div class="sportive-product-image-wrapper">
              {%- if product.featured_image -%}
                <img
                  src="{{ product.featured_image | image_url: width: 600 }}"
                  srcset="
                    {{ product.featured_image | image_url: width: 300 }} 300w,
                    {{ product.featured_image | image_url: width: 600 }} 600w,
                    {{ product.featured_image | image_url: width: 900 }} 900w
                  "
                  sizes="(min-width: 1280px) 300px, (min-width: 990px) 33vw, (min-width: 640px) 50vw, 100vw"
                  alt="{{ product.featured_image.alt | escape }}"
                  loading="lazy"
                  class="sportive-product-image"
                  width="600"
                  height="900"
                >
              {%- else -%}
                <div class="sportive-product-placeholder">
                  <div class="sportive-product-placeholder-icon">
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <rect x="3" y="3" width="18" height="18" rx="2" stroke="currentColor" stroke-width="2"/>
                      <path d="M3 9H21" stroke="currentColor" stroke-width="2"/>
                      <path d="M9 21V9" stroke="currentColor" stroke-width="2"/>
                    </svg>
                  </div>
                  <div class="sportive-product-placeholder-text">Product Image</div>
                </div>
              {%- endif -%}

              {%- comment -%} Quick View Overlay {%- endcomment -%}
              {%- if section.settings.show_quick_view -%}
                <div class="sportive-quick-view">
                  <button type="button" class="sportive-quick-view-btn" data-product-id="{{ product.id }}">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M8 3C4.5 3 1.73 5.11 0.86 8C1.73 10.89 4.5 13 8 13C11.5 13 14.27 10.89 15.14 8C14.27 5.11 11.5 3 8 3ZM8 11C6.34 11 5 9.66 5 8C5 6.34 6.34 5 8 5C9.66 5 11 6.34 11 8C11 9.66 9.66 11 8 11ZM8 6.5C7.17 6.5 6.5 7.17 6.5 8C6.5 8.83 7.17 9.5 8 9.5C8.83 9.5 9.5 8.83 9.5 8C9.5 7.17 8.83 6.5 8 6.5Z" fill="currentColor"/>
                    </svg>
                    Quick View
                  </button>
                </div>
              {%- endif -%}
            </div>

            {%- comment -%} Product Info {%- endcomment -%}
            <div class="sportive-product-info">
              {%- if section.settings.show_category and product.collections.size > 0 -%}
                <p class="sportive-product-category">
                  {{ product.collections.first.title }}
                </p>
              {%- endif -%}

              <h3 class="sportive-product-title">{{ product.title }}</h3>

              {%- if section.settings.show_reviews -%}
                <div class="sportive-product-meta">
                  <div class="sportive-product-rating">
                    {%- comment -%} Star rating - this would come from a review app {%- endcomment -%}
                    <span>★★★★★</span>
                  </div>
                  <span class="sportive-product-reviews">({{ product.metafields.reviews.rating_count | default: 0 }})</span>
                </div>
              {%- endif -%}

              <div class="sportive-product-price-wrapper">
                {%- if product.price_varies -%}
                  <span class="sportive-product-price-from">From</span>
                {%- endif -%}
                <span class="sportive-product-price">{{ product.price | money }}</span>
              </div>
            </div>
          </a>
        {%- endfor -%}
      </div>

      {%- comment -%} Load More Button {%- endcomment -%}
      {%- if section.settings.show_view_all and collection.products.size > section.settings.products_to_show -%}
        <div style="text-align: center; margin-top: 3rem;">
          <a href="{{ collection.url }}" class="btn btn-primary btn-lg">
            View All {{ collection.title }}
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M7.5 15L12.5 10L7.5 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </a>
        </div>
      {%- endif -%}

    {%- else -%}
      <div class="sportive-products-empty" style="text-align: center; padding: 4rem 2rem;">
        <svg width="100" height="100" viewBox="0 0 100 100" fill="none" style="margin: 0 auto 2rem; opacity: 0.3;">
          <rect x="10" y="10" width="80" height="80" rx="8" stroke="currentColor" stroke-width="2"/>
          <line x1="30" y1="30" x2="70" y2="70" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          <line x1="70" y1="30" x2="30" y2="70" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
        <h3 style="font-size: 1.5rem; margin-bottom: 1rem;">No products found</h3>
        <p style="color: #666; margin-bottom: 2rem;">Please select a collection with products in the theme editor.</p>
        {%- if request.design_mode -%}
          <a href="#" class="btn btn-primary">Configure Collection</a>
        {%- endif -%}
      </div>
    {%- endif -%}
  </div>
</div>

{% schema %}
{
  "name": "Sportive Prints Enhanced",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "All Sportive Prints"
    },
    {
      "type": "richtext",
      "id": "description",
      "label": "Description",
      "default": "<p>Browse our complete collection of iconic cycling routes and events</p>"
    },
    {
      "type": "collection",
      "id": "collection",
      "label": "Collection"
    },
    {
      "type": "range",
      "id": "products_to_show",
      "min": 4,
      "max": 32,
      "step": 4,
      "label": "Products to show",
      "default": 12
    },
    {
      "type": "header",
      "content": "Product Card Settings"
    },
    {
      "type": "checkbox",
      "id": "show_badge",
      "label": "Show product badges",
      "default": true,
      "info": "Displays badges like 'Bestseller' or custom metafield badges"
    },
    {
      "type": "checkbox",
      "id": "show_category",
      "label": "Show product category",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_reviews",
      "label": "Show product reviews",
      "default": true,
      "info": "Requires a review app to be installed"
    },
    {
      "type": "checkbox",
      "id": "show_quick_view",
      "label": "Show quick view button",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_view_all",
      "label": "Show 'View All' button",
      "default": true,
      "info": "Shows when collection has more products than displayed"
    }
  ],
  "presets": [
    {
      "name": "Sportive Prints Enhanced"
    }
  ]
}
{% endschema %}
